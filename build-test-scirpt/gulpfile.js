var gulp=require("gulp"),pug=require("gulp-pug"),less=require("gulp-less"),clean=require("gulp-clean"),zip=require("gulp-zip"),minifyCss=require("gulp-minify-css"),uglify=require("gulp-uglify"),htmlmin=require("gulp-htmlmin"),concat=require("gulp-concat"),rev=require("gulp-rev"),revCollector=require("gulp-rev-collector"),gulpSequence=require("gulp-sequence"),gulpRemoveLogging=require("gulp-remove-logging"),config=require("../config/config"),htmlConfig=require("../config/html-config"),tar=require("gulp-tar"),gzip=require("gulp-gzip"),changed=require("gulp-changed"),jscs=require("gulp-jscs"),fs=require("fs"),deleteFolder=function(e){fs.existsSync(e)&&(fs.readdirSync(e).forEach(function(s,i){var p=e+"/"+s;fs.statSync(p).isDirectory()?deleteFolder(p):fs.unlinkSync(p)}),fs.rmdirSync(e))},autoprefixer=require("gulp-autoprefixer"),htmlreplace=require("gulp-html-replace");gulp.task("templates",function(){var e={removeComments:!0,collapseWhitespace:!0,collapseBooleanAttributes:!0,removeEmptyAttributes:!0,removeScriptTypeAttributes:!0,removeStyleLinkTypeAttributes:!0,minifyJS:!0,minifyCSS:!0};gulp.src("../templates/*.html").pipe(htmlmin(e)).pipe(gulp.dest("../build/templates"))}),gulp.task("share",function(){var e={removeComments:!0,collapseWhitespace:!0,collapseBooleanAttributes:!0,removeEmptyAttributes:!0,removeScriptTypeAttributes:!0,removeStyleLinkTypeAttributes:!0,minifyJS:!0,minifyCSS:!0};gulp.src("../share/*.html").pipe(htmlreplace(htmlConfig)).pipe(htmlmin(e)).pipe(gulp.dest("../build/share"))}),gulp.task("styles-less",function(){return gulp.src("../styles/less/*.less").pipe(less()).pipe(minifyCss({keepSpecialComments:"*"})).pipe(gulp.dest("../build/styles/css"))}),gulp.task("styles-css",function(){return gulp.src(["../styles/css/*.css"]).pipe(minifyCss({keepSpecialComments:"*"})).pipe(rev()).pipe(gulp.dest("../build/styles/css")).pipe(rev.manifest({base:".",merge:!0})).pipe(gulp.dest("../build/rev/css"))}),gulp.task("scripts",function(){gulp.src(["!../scripts/*.min.js","../scripts/*.js"]).pipe(gulpRemoveLogging()).pipe(uglify()).pipe(rev()).pipe(gulp.dest("../build/scripts")).pipe(rev.manifest({base:".",merge:!0})).pipe(gulp.dest("../build/rev/js"))}),gulp.task("xx",function(){gulp.src(["../scripts/lawyer-order-new.js"]).pipe(gulpRemoveLogging()).pipe(uglify()).pipe(rev()).pipe(gulp.dest("../build/scripts")).pipe(rev.manifest({base:".",merge:!0})).pipe(gulp.dest("../build/rev/scripts/js"))}),gulp.task("libs-common-rev",function(){return gulp.src(["../libs/common.js","../libs/mui.picker.js","../libs/mui.poppicker.js","../libs/mui.pullToRefresh.js","../libs/mui.pullToRefresh.material.js"]).pipe(gulpRemoveLogging()).pipe(uglify()).pipe(rev()).pipe(gulp.dest("../build/libs")).pipe(rev.manifest({base:".",merge:!0})).pipe(gulp.dest("../build/rev/libs/js"))}),gulp.task("images",function(){return gulp.src(["../images/*"]).pipe(gulp.dest("../build/images"))}),gulp.task("fonts",function(){return gulp.src(["../fonts/*"]).pipe(gulp.dest("../build/fonts"))}),gulp.task("data-mocks",function(){return gulp.src("../data-mocks/*").pipe(gulp.dest("../build/data-mocks"))}),gulp.task("plugins",function(){return gulp.src("../plugins/**/*").pipe(gulp.dest("../build/plugins"))}),gulp.task("libs",function(){return gulp.src(["!../libs/common.js","!../libs/common.min.js","!../libs/mui.picker.js","!../libs/mui.poppicker.js","!../libs/mui.pullToRefresh.js","!../libs/mui.pullToRefresh.material.js","../libs/*.js"]).pipe(gulp.dest("../build/libs"))});var path=require("path");gulp.task("clean",function(){deleteFolder("../build"),deleteFolder("../dist")}),gulp.task("revTemplates",function(){gulp.src(["../build/rev/**/*.json","../build/templates/*.html"]).pipe(revCollector()).pipe(gulp.dest("../build/templates"))}),gulp.task("zip",function(){gulp.src(["../build/**/*"]).pipe(gulp.dest("../dist/"+config.version)).on("end",function(){gulp.src(["../dist/**/*"]).pipe(zip(config.version+".zip")).pipe(gulp.dest("../dist")).on("end",function(){config.version})})}),gulp.task("dist-share",function(){gulp.src(["../build/share/*"]).pipe(gulp.dest("../dist/share")).on("end",function(){gulp.src(["../dist/share/*"])})}),gulp.task("release",gulpSequence("clean","libs","styles-less","styles-css","scripts","libs-common-rev","data-mocks","plugins","share","templates","images","fonts","revTemplates","dist-share","zip")),gulp.task("default",["release"]);